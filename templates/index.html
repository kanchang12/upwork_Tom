<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Viewer</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Email Viewer</h1>
        <form id="emailForm" class="mt-4" action="/" method="POST">
            <div class="form-group">
                <label for="keyword">Keyword:</label>
                <input type="text" class="form-control" id="keyword" name="keyword" placeholder="Enter keyword">
            </div>
            <button type="submit" id="fetchBtn" class="btn btn-primary">Fetch Email</button>
        </form>
        
        {% if email %}
        <div class="email-container mt-5">
            <div class="email-header">
                <p><strong>Date:</strong> {{ email.date }}</p>
                <p><strong>From:</strong> {{ email.sender }}</p>
                <p><strong>Subject:</strong> {{ email.subject }}</p>
            </div>
            <div class="email-body">
                <p><strong>Body:</strong></p>
                <p>{{ email.body }}</p>
            </div>
            <div class="email-attachments">
                <p><strong>Attachments:</strong></p>
                {% for attachment in email.attachments %}
                <a href="/download/{{ attachment.data }}?message_id={{ attachment.messageId }}" target="_blank">{{ attachment.filename }}</a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if error %}
        <div class="alert alert-danger mt-5" role="alert">
            {{ error }}
        </div>
        {% endif %}
    </div>

    <script>
        const emailForm = document.getElementById('emailForm');
        const keywordInput = document.getElementById('keyword');
        const fetchBtn = document.getElementById('fetchBtn');

        // Function to handle voice input
        function handleVoiceInput() {
            const recognition = new webkitSpeechRecognition() || new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.start();

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                keywordInput.value = transcript;
                setTimeout(() => {
                    fetchBtn.click();
                }, 2000); // Click fetch button after 2 seconds
            };
        }

        // Event listener for voice button
        keywordInput.addEventListener('click', handleVoiceInput);
    </script>
</body>
</html>
